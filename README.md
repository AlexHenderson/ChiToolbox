
# CHI Toolbox #
## Centre for Hyperspectral Imaging at the University of Manchester ##


MATLAB code for handling hyperspectral data generated by SIMS and FTIR instruments.

Author: Alex Henderson <alex.henderson@manchester.ac.uk>

Start date 17 March 2014 (although coding has been in progress for many years). Still work in progress...

If you find a problem with the Toolbox, please document the 'issue' on the Bitbucket site [https://bitbucket.org/AlexHenderson/chitoolbox/issues](https://bitbucket.org/AlexHenderson/chitoolbox/issues "https://bitbucket.org/AlexHenderson/chitoolbox/issues"), or email Alex. Similarly, requests for new features can be sent in the same way. 

## File formats
The following file formats are supported:

- Agilent (FTIR)
	- Single FTIR images (.seq files) using ChiAgilentFile
	- Mosaicked FTIR images (.dms files) using ChiAgilentFile    
- Biotof (ToFSIMS)
	-  Retrospective image files (*.xyt files) using ChiBiotofFile
- Bruker (FTIR)
	- Multiple spectra exported as a .mat file using ChiBrukerFile
- Ionoptika (ToFSIMS)
	-  Retrospective image files exported in the .h5 format using ChiIonoptikaFile
- Renishaw (Raman)
	- WiRE Version 4 (*.wdf files), single spectra, multiple spectra, images using ChiRenishawFile
- Thermo Fisher Scientific GRAMS SPC (Generic)
	- Data stored in .spc files using ChiThermoFile

## Licence
The ChiToolbox is copyright (c) 2014-2018 Alex Henderson   
It is released under the GNU GPL 3.0 licence, a copy of which is included in the file collection, but which may also be found at [https://www.gnu.org/licenses/gpl-3.0.en.html](https://www.gnu.org/licenses/gpl-3.0.en.html)

The licences of the included files, detailed in the Credits section below, are equally or more liberal in nature.  

## Credits

Standing on the shoulders of giants, the following code is included in the Toolbox.

#### Perceptually uniform colormaps
Version 1.3.1   
Copyright (c) 2016, Ander Biguri    
Available from [https://uk.mathworks.com/matlabcentral/fileexchange/51986-perceptually-uniform-colormaps](https://uk.mathworks.com/matlabcentral/fileexchange/51986-perceptually-uniform-colormaps) 

#### error_ellipse
Version 1.0   
Copyright (c) 2004, AJ Johnson   
Available from [https://uk.mathworks.com/matlabcentral/fileexchange/4705-error-ellipse](https://uk.mathworks.com/matlabcentral/fileexchange/4705-error-ellipse)

#### GSTools
Version 1.3   
Copyright (c) 2006, Kris De Gussem   
Available from [https://uk.mathworks.com/matlabcentral/fileexchange/9938-gstools](https://uk.mathworks.com/matlabcentral/fileexchange/9938-gstools)

#### raacampbell/shadedE​rrorBar
Version 1.65 (downloaded from Github 2018-02-07, commit 1ea286c)   
Rob Campbell   
Available from [https://uk.mathworks.com/matlabcentral/fileexchange/26311-raacampbell-shadederrorbar](https://uk.mathworks.com/matlabcentral/fileexchange/26311-raacampbell-shadederrorbar)    
See also [https://github.com/raacampbell/shadedErrorBar](https://github.com/raacampbell/shadedErrorBar)

#### mksqlite
Version 2.5   
Martin Kortmann and Andreas Martin   
Available from [http://mksqlite.sourceforge.net/](http://mksqlite.sourceforge.net/)    
See also [https://github.com/AndreasMartin72/mksqlite](https://github.com/AndreasMartin72/mksqlite)

#### sql_object
Version 1.1   
Andreas Martin   
Available from [https://uk.mathworks.com/matlabcentral/fileexchange/58433-using-sqlite-databases-via-objects](https://uk.mathworks.com/matlabcentral/fileexchange/58433-using-sqlite-databases-via-objects)    

#### cividis
Jamie R. Nuñez, Christopher R. Anderton, Ryan S. Renslow   
Available from [https://github.com/pnnl/cmaputil](https://github.com/pnnl/cmaputil)   
See also [https://arxiv.org/abs/1712.01662](https://arxiv.org/abs/1712.01662 "https://arxiv.org/abs/1712.01662")    

#### sgolayfilt
Version 1.0   
Andrew D. Horchler    
Available from [https://github.com/horchler/sgolayfilt](https://github.com/horchler/sgolayfilt)   

#### RMieS
Version 5.0   
Paul Bassan    
Available from [https://github.com/GardnerLabUoM/RMieS](https://github.com/GardnerLabUoM/RMieS)   

## Example usage

### Example 1
Assuming you have a .spc file in this location: C:\mydata\myfile.spc
    
    filename = 'C:\mydata\myfile.spc';
    myfile = ChiSPCFile.open(filename);
	myfile.plot;



----------
### Example 2
Assuming you have multiple SPC files in the same folder

    myfile = ChiSPCFile.open();

A dialog box will open allowing you to navigate to the location of the files. Select as many as required.  

	myfile.plot;			% overlay of the spectra
	myfile.plot('mean');	% mean of the spectra
	
	myfile.history.log		% list of filenames

Perform principal components analysis
	
	pca2 = myfile.pca;
	pca2.plotloadings(1);	% the loading on pc 1
	pca2.plotloadings(2);	% the loading on pc 2
	pca2.plotscores(1,2);	% scores plot of pcs 1 and 2

----------
### Example 3
Vector normalisation 

    myfile = ChiSPCFile.open();

A dialog box will open allowing you to navigate to the location of the files. Select as many as required.  


Both the following lines do the same thing, producing a **copy** of the data that has been vector normalised.

	myfilevn = myfile.vectornorm;
	myfilevn = vectornorm(myfile);

The following line vector normalises the data *in situ* and does not produce a copy. Note the original variable is **modified** (nothing changes the files on disc). 

	myfile.vectornorm;


----------
### Example 4
Assuming there are 8 SPC files and you have some *a priori* knowledge. Assume there are three classes of data 'alpha', 'beta' and 'gamma' and the files are in the order: beta, gamma, gamma, beta, beta, beta, alpha, alpha

    spectra = ChiSPCFile.open();	% select the 8 files

	apriori = ChiClassMembership('myinfo','beta',1, 'gamma',2, 'beta',3, 'alpha',2);
	spectra.classmembership = apriori;

	spectra.plot					% overlay of all spectra
	spectra.plot('byclass')			% overlay of all spectra with the same classes in the same colour
	spectra.plot('mean')			% mean of the 8 spectra
	spectra.plot('mean','byclass')	% mean of each of the classes 

	pca3 = spectra.pca;
	pca3.plotscores(1,2);	% scores plot of pcs 1 and 2 labelled according to the class structure

----------
### Example 5
Assuming you have an Agilent FTIR image tile in this location: C:\mydata\myfile.seq
    
    filename = 'C:\mydata\myfile.seq';
    myimage = ChiAgilentFile.open(filename);

	myimage.display;		% total intensity image
	myimage.plot('mean');	% the average spectrum across all pixels in the image
	myimage.plot('std'); 	% the average spectrum, with the standard deviation shaded, across all pixels in the image

To perform principal components analysis on the image

	pcaresult = myimage.pca;
	pcaresult.imagepc(1);		% scores image of principal component 1
	pcaresult.plotloading(1);	% loading on pc 1
	pcaresult.plotexplainedvariance;	% percentage explained variance
	pcaresult.plotcumexplainedvariance;	% cumulative percentage explained variance, with a line at 95%

